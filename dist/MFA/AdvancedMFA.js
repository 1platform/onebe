"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AdvancedMFA = void 0;

var _qrcode = _interopRequireDefault(require("qrcode"));

var _speakeasy = _interopRequireDefault(require("speakeasy"));

var _App = _interopRequireDefault(require("../App"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * A service used to enable an Advanced MFA system to authenticate users through
 * an authentication application like Google Authenticator, Microsoft Authenticator etc.
 *
 * This class provides you with everything needed to easily implement the MFA using an
 * authenticator app (QRCode, OTP verifications etc).
 */
class AdvancedMFA {
  /**
   * Returns the MFA Configuration that you can reuse in your application.
   */
  getMFAConfig() {
    const secretCode = _speakeasy.default.generateSecret({
      name: _App.default.app.name
    });

    return {
      otpAuthUrl: secretCode.otpauth_url,
      base32: secretCode.base32
    };
  }
  /**
   * Generates a QR Code for the given OTPAuth URL.
   *
   * @param otpAuthURL The OTPAuth URL we want to generate a QRCode for.
   */


  getQRCode(otpAuthURL) {
    return _qrcode.default.toBuffer(otpAuthURL);
  }
  /**
   * Verifies a given MFA Authentication Code.
   *
   * @param authenticationCode The code generated by the Authenticator application.
   * @param userSecretMFACode The code use by the user to generate MFA codes.
   */


  verifyAuthenticationCode(authenticationCode, userSecretMFACode) {
    return _speakeasy.default.totp.verify({
      secret: userSecretMFACode,
      encoding: "base32",
      token: authenticationCode
    });
  }

}

exports.AdvancedMFA = AdvancedMFA;